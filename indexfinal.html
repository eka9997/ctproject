<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>비버의 숫자 분류 실험실</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f5f9ff;
      padding: 20px;
    }
    .section {
      margin-bottom: 20px;
    }
    .card-grid, .group-box {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .card {
      padding: 5px 10px;
      font-size: 12px;
      background-color: #fff;
      border: 2px solid #ccc;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s, color 0.3s;
    }
    .card.selected {
      outline: 3px solid #000;
    }
    .group-A {
      background-color: #f88;
      color: white;
    }
    .group-B {
      background-color: #88f;
      color: white;
    }
    .group-C {
      background-color: #4c4;
      color: white;
    }
    .group-button {
      padding: 10px 15px;
      margin: 5px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
    }
    .hint-box, #popup {
      display: none;
      background-color: #eee;
      padding: 15px;
      border: 2px solid #ccc;
      border-radius: 8px;
      margin-top: 10px;
    }
    #timer {
      font-size: 24px;
      font-weight: bold;
      color: #d33;
    }
    .group-container {
      margin-top: 20px;
    }
    .group-title {
      font-weight: bold;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <h1>비버의 숫자 분류 실험실</h1>
  <h2>대상 및 교과: 중학교 (수학)</h2>

  <div class="section">
    <strong>지문:</strong><br>
    비버는 숫자를 자동으로 분류하는 알고리즘을 개발 중입니다. 아래 제시된 예시 숫자들을 보고 A, B, C 그룹의 규칙을 스스로 유추한 뒤, 문제에 주어진 숫자들을 정확한 그룹에 분류해보세요.
  </div>

  <div class="section">
    <label>난이도 설정: 
      <select id="difficultySelect">
        <option value="easy">쉬움</option>
        <option value="medium" selected>보통</option>
        <option value="hard">어려움</option>
      </select>
    </label>
    <label>시간 설정: 
      <select id="timeSelect">
        <option value="120" selected>2분</option>
        <option value="30">30초</option>
        <option value="60">1분</option>
        <option value="90">1분 30초</option>
      </select>
    </label>
    <button onclick="startGame()">문제 풀기</button>
    <div id="timer"></div>
  </div>

  <div class="card-grid" id="options"></div>

  <div id="groupSelector">
    <button class="group-button" style="background-color:#f88" onclick="submitAnswer('A')">A 그룹</button>
    <button class="group-button" style="background-color:#88f" onclick="submitAnswer('B')">B 그룹</button>
    <button class="group-button" style="background-color:#4c4" onclick="submitAnswer('C')">C 그룹</button>
  </div>

  <button onclick="toggleHint()">힌트 보기</button>
  <div class="hint-box" id="hintBox">
    <ul id="hintContent"></ul>
  </div>

  <div class="group-container">
    <div class="group-title">A 그룹</div>
    <div class="card-grid" id="groupA"></div>
    <div class="group-title">B 그룹</div>
    <div class="card-grid" id="groupB"></div>
    <div class="group-title">C 그룹</div>
    <div class="card-grid" id="groupC"></div>
  </div>

  <div id="popup">
    <p id="popupMessage"></p>
    <button onclick="restartGame()">다시 도전</button>
  </div>

  <script>
    let selectedCard = null;
    let correctCount = 0;
    let total = 0;
    let timerInterval;
    let problemSet = [];
    let rules = {};

    function generateRule(difficulty) {
      const random = Math.random();
      if (random < 0.5) {
        const start = difficulty === 'hard' ? Math.floor(Math.random() * 5 + 2) : 2;
        const ratio = difficulty === 'easy' ? 2 : Math.floor(Math.random() * 3 + 2);
        return (i) => start * Math.pow(ratio, i);
      } else {
        const start = difficulty === 'hard' ? Math.floor(Math.random() * 10 + 1) : 3;
        const diff = difficulty === 'easy' ? 2 : Math.floor(Math.random() * 4 + 2);
        return (i) => start + diff * i;
      }
    }

    function startGame() {
      const difficulty = document.getElementById("difficultySelect").value;
      rules = {
        A: generateRule(difficulty),
        B: generateRule(difficulty),
        C: generateRule(difficulty)
      };

      const hintList = document.getElementById("hintContent");
      hintList.innerHTML = '';
      Object.keys(rules).forEach(group => {
        const values = Array.from({length: 5}, (_, i) => Math.floor(rules[group](i)));
        const li = document.createElement("li");
        li.innerText = `${group} 그룹: ${values.join(', ')}`;
        hintList.appendChild(li);
      });

      const container = document.getElementById('options');
      container.innerHTML = '';
      document.getElementById("groupA").innerHTML = '';
      document.getElementById("groupB").innerHTML = '';
      document.getElementById("groupC").innerHTML = '';

      problemSet = [];
      ['A','B','C'].forEach(g => {
        for(let i=5;i<10;i++){
          const val = Math.floor(rules[g](i));
          if (!problemSet.some(p => p.num === val)) {
            problemSet.push({ num: val, group: g });
          }
        }
      });
      problemSet = shuffleArray(problemSet);

      problemSet.forEach(item => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerText = item.num;
        div.dataset.group = item.group;
        div.onclick = () => {
          document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
          selectedCard = div;
          div.classList.add('selected');
        };
        container.appendChild(div);
      });

      correctCount = 0;
      total = problemSet.length;
      document.getElementById("popup").style.display = 'none';
      startTimer();
    }

    function submitAnswer(group) {
      if (!selectedCard) return;
      const actual = selectedCard.dataset.group;
      if (group === actual) {
        selectedCard.classList.add(`group-${group}`);
        const clone = selectedCard.cloneNode(true);
        document.getElementById(`group${group}`).appendChild(clone);
        selectedCard.remove();
        correctCount++;
        if (correctCount === total) {
          document.getElementById("popupMessage").innerText = "모든 정답을 찾았습니다!";
          document.getElementById("popup").style.display = 'block';
          clearInterval(timerInterval);
        }
      } else {
        alert("다시 풀어보세요!");
      }
      selectedCard = null;
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function toggleHint() {
      const box = document.getElementById("hintBox");
      box.style.display = box.style.display === 'block' ? 'none' : 'block';
    }

    function startTimer() {
      let time = parseInt(document.getElementById("timeSelect").value);
      const timer = document.getElementById("timer");
      timer.innerText = `${time} 초`;
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        time--;
        timer.innerText = `${time} 초`;
        if (time <= 0) {
          clearInterval(timerInterval);
          document.getElementById("popupMessage").innerText = "⌛ 시간이 종료되었습니다!";
          document.getElementById("popup").style.display = 'block';
        }
      }, 1000);
    }

    function restartGame() {
      startGame();
    }
  </script>
</body>
</html>
